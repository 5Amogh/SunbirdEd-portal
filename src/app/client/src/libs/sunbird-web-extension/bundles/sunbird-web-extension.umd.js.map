{"version":3,"file":"sunbird-web-extension.umd.js.map","sources":["ng://sunbird-web-extension/models.ts","ng://sunbird-web-extension/plugin-service.ts","ng://sunbird-web-extension/extension-point.directive.ts","ng://sunbird-web-extension/BootstrapFramework.ts","ng://sunbird-web-extension/app.module.ts"],"sourcesContent":["export const PluginConfig = (config) => {\n  return (type) => {\n    type._pluginConfig = config;\n  };\n};\n\nexport class PluginPlacement {\n  public name;\n  public priority;\n  public component;\n  constructor(options) {\n    this.name = options.name;\n    this.priority = options.priority;\n    this.component = options.component;\n  }\n}\n\nexport class PluginData {\n  public plugin;\n  public placement;\n  constructor(plugin, placement) {\n    this.plugin = plugin;\n    this.placement = placement;\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {PluginData} from './models';\nimport { ReplaySubject } from 'rxjs';\n\n@Injectable()\nexport class PluginService {\n  public plugins;\n  public change;\n  private config;\n\n  constructor() {\n    this.plugins = [];\n    this.change = new ReplaySubject(1);\n  }\n\n  loadPlugins(config: any) {\n    if (!config || !Array.isArray(config.plugins)) {\n      throw new Error('invalid framework configuration! Failed to load plugins!');\n    }\n\n    const plugins = config.plugins.map((data) => data.main);\n    for (const plugin of plugins) {\n      this.loadPlugin(plugin);\n    }\n  }\n\n  loadPlugin(plugin) {\n      const Plugin = <any>plugin;\n      const pluginData = {\n        type: Plugin,\n        config: Plugin._pluginConfig,\n        instance: new Plugin()\n      };\n      this.plugins = this.plugins.concat([pluginData]);\n      this.change.next(this.plugins);\n  }\n\n  removePlugin(name: string) {\n    const plugin = this.plugins.find((pluginObj) => pluginObj.name === name);\n    if (plugin) {\n      const plugins = this.plugins.slice();\n      plugins.splice(plugins.indexOf(plugin), 1);\n      this.plugins = plugins;\n      this.change.next(this.plugins);\n    }\n  }\n\n  getPluginData(name: string) {\n    return this.plugins.reduce((components, pluginData) => {\n      return components.concat(\n        pluginData.config.placements\n          .filter((placement) => placement.name === name)\n          .map((placement) => new PluginData(pluginData, placement))\n      );\n    }, []);\n  }\n}\n","import {\n  Directive, Input, Inject, Provider, ViewContainerRef,\n  ComponentFactoryResolver, ReflectiveInjector, OnDestroy, OnChanges, EventEmitter, Output, OnInit, ComponentRef\n} from '@angular/core';\nimport { PluginData } from './models';\nimport { PluginService } from './plugin-service';\nimport { Subscription } from 'rxjs';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'extension-point'\n})\nexport class ExtensionPointDirective implements OnInit, OnChanges, OnDestroy {\n  @Input() name: string;\n  @Input() override: Boolean = false;\n  @Input() input: any;\n  @Output() output: EventEmitter<any> = new EventEmitter();\n  public viewContainerRef: ViewContainerRef;\n  public componentResolver: ComponentFactoryResolver;\n  public pluginService: PluginService;\n  public componentRefs: Array<any> = [];\n  public pluginChangeSubscription: Subscription;\n\n  constructor(@Inject(ViewContainerRef) viewContainerRef, @Inject(ComponentFactoryResolver) componentResolver,\n    @Inject(PluginService) pluginService) {\n    this.viewContainerRef = viewContainerRef;\n    this.componentResolver = componentResolver;\n    this.pluginService = pluginService;\n    this.pluginChangeSubscription = this.pluginService.change.subscribe(x => this.initialize());\n  }\n\n  ngOnInit() {\n    this.initialize();\n  }\n\n  public initialize() {\n    if (!this.name) {\n      return;\n    }\n    const pluginData = this.pluginService.getPluginData(this.name);\n    if (this.override) {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return this.instantiatePluginComponent(pluginData.shift());\n    } else {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return Promise.all(pluginData.map(plugin => this.instantiatePluginComponent(plugin)));\n    }\n  }\n\n  public instantiatePluginComponent(pluginData) {\n    if (!pluginData) {\n      return;\n    }\n    const componentFactory = this.componentResolver.resolveComponentFactory(pluginData.placement.component);\n    const contextInjector = this.viewContainerRef.parentInjector;\n    const providers = [{ provide: PluginData, useValue: pluginData }];\n    const childInjector = ReflectiveInjector.resolveAndCreate(providers, contextInjector);\n    const componentRef: any = this.viewContainerRef.createComponent(componentFactory, this.viewContainerRef.length, childInjector);\n    componentRef.instance.input = this.input;\n    componentRef.instance.output = componentRef.instance.output || new EventEmitter();\n    componentRef.instance.output.subscribe(childComponentEvent => this.output.emit(childComponentEvent));\n    this.componentRefs.push(componentRef);\n    componentRef.changeDetectorRef.markForCheck();\n    componentRef.changeDetectorRef.detectChanges();\n    return componentRef;\n  }\n\n  ngOnChanges() {\n    if (this.componentRefs.length) {\n      this.componentRefs.forEach(componentRef => {\n        componentRef.instance.input = this.input;\n        return componentRef.instance.ngOnChanges ? componentRef.instance.ngOnChanges() : undefined;\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.componentRefs.length) {\n      this.componentRefs.forEach(componentRef => componentRef.destroy());\n      this.componentRefs = [];\n    }\n    this.pluginChangeSubscription.unsubscribe();\n  }\n}\n","import { PluginService } from './plugin-service';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class BootstrapFramework {\n\n  private config: any;\n\n  private pluginService: PluginService;\n\n  constructor(pluginService: PluginService) {\n    this.pluginService = pluginService;\n  }\n\n  initialize(config: any) {\n    this.config = config;\n    this.pluginService.loadPlugins(this.config);\n  }\n}\n","import { ExtensionPointDirective } from './extension-point.directive';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { PluginService } from './plugin-service';\nimport { BootstrapFramework } from './BootstrapFramework';\n\n@NgModule({\n  declarations: [\n    ExtensionPointDirective\n  ],\n  imports: [\n    BrowserModule\n  ],\n  exports: [\n    ExtensionPointDirective\n  ],\n  providers: [\n    PluginService,\n    BootstrapFramework\n  ],\n  entryComponents: []\n})\nexport class WebExtensionModule {\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: WebExtensionModule,\n      providers: [PluginService]\n    };\n  }\n}\n\n\n"],"names":["ReplaySubject","tslib_1.__values","Injectable","EventEmitter","ReflectiveInjector","Directive","Inject","ViewContainerRef","ComponentFactoryResolver","Input","Output","NgModule","BrowserModule"],"mappings":"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"}
