{"version":3,"file":"sunbird-web-extension.js.map","sources":["ng://sunbird-web-extension/models.ts","ng://sunbird-web-extension/plugin-service.ts","ng://sunbird-web-extension/extension-point.directive.ts","ng://sunbird-web-extension/BootstrapFramework.ts","ng://sunbird-web-extension/app.module.ts"],"sourcesContent":["export const PluginConfig = (config) => {\n  return (type) => {\n    type._pluginConfig = config;\n  };\n};\n\nexport class PluginPlacement {\n  public name;\n  public priority;\n  public component;\n  constructor(options) {\n    this.name = options.name;\n    this.priority = options.priority;\n    this.component = options.component;\n  }\n}\n\nexport class PluginData {\n  public plugin;\n  public placement;\n  constructor(plugin, placement) {\n    this.plugin = plugin;\n    this.placement = placement;\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {PluginData} from './models';\nimport { ReplaySubject } from 'rxjs';\n\n@Injectable()\nexport class PluginService {\n  public plugins;\n  public change;\n  private config;\n\n  constructor() {\n    this.plugins = [];\n    this.change = new ReplaySubject(1);\n  }\n\n  loadPlugins(config: any) {\n    if (!config || !Array.isArray(config.plugins)) {\n      throw new Error('invalid framework configuration! Failed to load plugins!');\n    }\n\n    const plugins = config.plugins.map((data) => data.main);\n    for (let plugin of plugins) {\n      this.loadPlugin(plugin);\n    }\n  }\n\n  loadPlugin(plugin) {\n      const Plugin = <any>plugin;\n      const pluginData = {\n        type: Plugin,\n        config: Plugin._pluginConfig,\n        instance: new Plugin()\n      };\n      this.plugins = this.plugins.concat([pluginData]);\n      this.change.next(this.plugins);\n  }\n\n  removePlugin(name: string) {\n    const plugin = this.plugins.find((pluginObj) => pluginObj.name === name);\n    if (plugin) {\n      const plugins = this.plugins.slice();\n      plugins.splice(plugins.indexOf(plugin), 1);\n      this.plugins = plugins;\n      this.change.next(this.plugins);\n    }\n  }\n\n  getPluginData(name: string) {\n    return this.plugins.reduce((components, pluginData) => {\n      return components.concat(\n        pluginData.config.placements\n          .filter((placement) => placement.name === name)\n          .map((placement) => new PluginData(pluginData, placement))\n      );\n    }, []);\n  }\n}\n","import {Directive, Input, Inject, Provider, ViewContainerRef,\n  ComponentFactoryResolver, ReflectiveInjector, OnDestroy, OnChanges} from '@angular/core';\nimport {PluginData} from './models';\nimport {PluginService} from './plugin-service';\n\n@Directive({\n  selector: 'extension-point'\n})\nexport class ExtenstionPointDirective implements OnChanges, OnDestroy {\n  @Input() name: string;\n  @Input() override: Boolean = false;\n  public viewContainerRef;\n  public componentResolver;\n  public pluginService: PluginService;\n  public componentRefs;\n  public pluginChangeSubscription;\n\n  constructor(@Inject(ViewContainerRef) viewContainerRef, @Inject(ComponentFactoryResolver) componentResolver, \n  @Inject(PluginService) pluginService) {\n    this.viewContainerRef = viewContainerRef;\n    this.componentResolver = componentResolver;\n    this.pluginService = pluginService;\n    this.componentRefs = [];\n    this.pluginChangeSubscription = this.pluginService.change.subscribe(() => this.initialize());\n  }\n\n  public initialize() {\n    if (!this.name) {\n      return;\n    }\n\n    if (this.componentRefs.length > 0) {\n      this.componentRefs.forEach((componentRef) => componentRef.destroy());\n      this.componentRefs = [];\n    }\n\n    const pluginData = this.pluginService.getPluginData(this.name);\n    if (this.override) {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return this.instantiatePluginComponent(pluginData.shift());\n    } else {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return Promise.all(pluginData.map((plugin) => this.instantiatePluginComponent(plugin)));\n    }\n  }\n\n  public instantiatePluginComponent(pluginData) {\n    if (!pluginData) {\n      return;\n    }\n\n    const componentFactory = this.componentResolver.resolveComponentFactory(pluginData.placement.component);\n    const contextInjector = this.viewContainerRef.parentInjector;\n    const providers = [\n      { provide: PluginData, useValue: pluginData }\n    ];\n    const childInjector = ReflectiveInjector.resolveAndCreate(providers, contextInjector);\n    const componentRef = this.viewContainerRef.createComponent(componentFactory, this.viewContainerRef.length, childInjector);\n    this.componentRefs.push(componentRef);\n    componentRef.changeDetectorRef.markForCheck();\n    componentRef.changeDetectorRef.detectChanges();\n    return componentRef;\n  }\n\n  ngOnChanges() {\n    this.initialize();\n  }\n\n  ngOnDestroy() {\n    this.pluginChangeSubscription.unsubscribe();\n  }\n}\n","import { PluginService } from './plugin-service';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class BootstrapFramework {\n\n  private config: any;\n\n  private pluginService: PluginService;\n\n  constructor(pluginService: PluginService) {\n    this.pluginService = pluginService;\n  }\n\n  initialize(config: any) {\n    this.config = config;\n    this.pluginService.loadPlugins(this.config);\n  }\n}\n","import { ExtenstionPointDirective } from './extension-point.directive';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { PluginService } from './plugin-service';\nimport { BootstrapFramework } from './BootstrapFramework';\n\n@NgModule({\n  declarations: [\n    ExtenstionPointDirective\n  ],\n  imports: [\n    BrowserModule\n  ],\n  exports: [\n    ExtenstionPointDirective\n  ],\n  providers: [\n    PluginService,\n    BootstrapFramework\n  ],\n  entryComponents: []\n})\nexport class WebFrameworkModule {\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: WebFrameworkModule,\n      providers: [PluginService]\n    };\n  }\n}\n\n\n"],"names":["tslib_1.__values"],"mappings":"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"}
